<div class="container py-4">
  <div class="card shadow-sm border-0 p-4 profile-card">
    
    <!-- Avatar + Name -->
    <div class="text-center mb-4">
      <div class="profile-avatar">
        <i class="bi bi-person-fill"></i>
      </div>
      <h4 class="mt-3">{{ profile.fullName || 'User' }}</h4>
      <p class="text-muted">{{ role | titlecase }}</p>
    </div>

    <!-- Profile Fields -->
    <div class="row">
      <div 
        class="col-md-6 mb-3"
        *ngFor="let field of (role === 'employer' ? employerFields : seekerFields)">
        
        <div class="profile-field">
          <label>{{ field.label }}</label>

          <!-- Display Mode -->
          <div *ngIf="editableField !== field.key" class="field-display">
            <!-- Special handling for createdAt -->
            <span *ngIf="field.key === 'createdAt'">
              {{ profile[field.key] ? (profile[field.key] | date: 'dd MMM yyyy') : '—' }}
            </span>
            <span *ngIf="field.key !== 'createdAt'">
              {{ profile[field.key] || '—' }}
            </span>
            
            <i *ngIf="field.editable" 
               class="bi bi-pencil edit-icon" 
               (click)="enableEdit(field.key)"></i>
          </div>

          <!-- Edit Mode -->
          <div *ngIf="editableField === field.key && field.key !== 'createdAt'" class="edit-mode">
            <input 
              type="text" 
              class="form-control" 
              [(ngModel)]="profile[field.key]"
            />
            <div class="mt-2">
              <button class="btn btn-success btn-sm" (click)="saveField(field.key)">Save</button>
              <button class="btn btn-secondary btn-sm" (click)="editableField = null">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="text-center mt-4 d-flex justify-content-center gap-3 flex-wrap">
      <button class="btn btn-warning px-4" (click)="openPasswordModal()">Update Password</button>
      <button class="btn btn-danger px-4" (click)="openDeleteModal()">Delete Profile</button>
    </div>
  </div>
</div>


<!-- Password Modal -->
<div class="modal fade show" *ngIf="showPasswordModal" style="display:block; background:rgba(0,0,0,0.5);">
  <div class="modal-dialog">
    <div class="modal-content border-0 shadow-sm">
      <div class="modal-header">
        <h5 class="modal-title">Update Password</h5>
        <button type="button" class="btn-close" (click)="closePasswordModal()"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label>Current Password</label>
          <input type="password" class="form-control" [(ngModel)]="passwordForm.currentPassword">
        </div>
        <div class="mb-3">
          <label>New Password</label>
          <input type="password" class="form-control" [(ngModel)]="passwordForm.newPassword">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closePasswordModal()">Cancel</button>
        <button class="btn btn-success" (click)="updatePassword()">Update</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Profile Modal -->
<div class="modal fade show" *ngIf="showDeleteModal" style="display: block;" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">Confirm Delete Profile</h5>
        <button type="button" class="btn-close" (click)="closeDeleteModal()"></button>
      </div>

      <div class="modal-body">
        <p>This action is permanent. Please enter your password to confirm.</p>
        <input type="password" [(ngModel)]="deletePassword" placeholder="Enter your password" class="form-control">
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" (click)="confirmDeleteProfile()">Delete</button>
      </div>

    </div>
  </div>
</div>
